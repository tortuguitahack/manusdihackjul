{
  "name": "01_AMZ_Influencer_Shorts_v2025",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "hours": 4
            }
          ]
        },
        "options": {
          "timezone": "America/La_Paz"
        }
      },
      "id": "trigger",
      "name": "Cada 4h",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        100,
        200
      ]
    },
    {
      "parameters": {
        "operation": "lookup",
        "sheetId": "{{$env.GOOGLE_SHEET_ID}}",
        "range": "ASIN!A:E",
        "key": "usado",
        "keyValue": "no"
      },
      "id": "get_asin",
      "name": "Get ASIN Libre",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 2,
      "position": [
        300,
        200
      ],
      "credentials": {
        "googleSheetsOAuth2Api": "Google-Diego"
      }
    },
    {
      "parameters": {
        "model": "gpt-4o-latest",
        "messages": [
          {
            "role": "system",
            "value": "Eres un reviewer técnico latino. Devuelve JSON: {\"title\":\"max 60 chars\",\"hook\":\"max 100 chars\",\"body\":\"max 250 chars\",\"cta\":\"max 50 chars\"}"
          },
          {
            "role": "user",
            "value": "Producto: {{$json.Nombre}} ({{$json.ASIN}})"
          }
        ],
        "options": {
          "temperature": 0.7
        }
      },
      "id": "gpt4o",
      "name": "GPT-4o Script",
      "type": "n8n-nodes-base.openAi",
      "position": [
        500,
        200
      ],
      "credentials": {
        "openAiApi": "OpenAI-Diego"
      }
    },
    {
      "parameters": {
        "text": "={{JSON.parse($json.choices[0].message.content).title}}",
        "voice": "Antonio (Spanish - latam)",
        "model": "eleven_multilingual_v2",
        "voice_settings": {
          "stability": 0.4,
          "similarity_boost": 0.8
        }
      },
      "id": "tts",
      "name": "TTS Voice-Design",
      "type": "n8n-nodes-base.elevenLabs",
      "position": [
        700,
        200
      ],
      "credentials": {
        "elevenLabsApi": "ElevenLabs-Diego"
      }
    },
    {
      "parameters": {
        "operation": "generateImage",
        "model": "stable-diffusion-3-5-large",
        "prompt": "Realistic vertical photo of {{$json.Nombre}}, clean background, 9:16, 4K",
        "aspect_ratio": "9:16",
        "output_format": "png"
      },
      "id": "sd35",
      "name": "SD 3.5 4K",
      "type": "n8n-nodes-base.stabilityAi",
      "position": [
        900,
        200
      ],
      "credentials": {
        "stabilityAiApi": "Stability-Diego"
      }
    },
    {
      "parameters": {
        "operation": "createVideo",
        "template": "vertical_review",
        "images": [
          "={{$json.data[0].url}}"
        ],
        "audio": "={{$json.audio}}",
        "resolution": "1080x1920"
      },
      "id": "fal",
      "name": "Fal.ai Video",
      "type": "n8n-nodes-base.falAi",
      "position": [
        1100,
        200
      ],
      "credentials": {
        "falAiApi": "Fal-Diego"
      }
    },
    {
      "parameters": {
        "operation": "uploadShort",
        "asin": "={{$json.ASIN}}",
        "video": "={{$json.video}}",
        "title": "={{JSON.parse($json.choices[0].message.content).title}}",
        "description": "={{JSON.parse($json.choices[0].message.content).hook}} {{JSON.parse($json.choices[0].message.content).cta}}",
        "vertical": true
      },
      "id": "amzUp",
      "name": "Amazon Upload",
      "type": "n8n-nodes-base.amazonInfluencer",
      "position": [
        1300,
        200
      ],
      "credentials": {
        "amazonInfluencerApi": "Amazon-Diego"
      }
    },
    {
      "parameters": {
        "url": "{{$env.WEBHOOK_DASHBOARD_URL}}/api/webhooks/n8n",
        "httpMethod": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer {{$env.WEBHOOK_SECRET}}"
        },
        "body": {
          "workflowId": "01_AMZ_Influencer",
          "status": "completed",
          "earnings": 2.5,
          "timestamp": "={{$now.toISOString()}}",
          "metadata": {
            "asin": "={{$json.ASIN}}",
            "videoUrl": "={{$json.video}}",
            "title": "={{JSON.parse($json.choices[0].message.content).title}}"
          }
        }
      },
      "id": "dashboardWebhook",
      "name": "Send to Dashboard",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1500,
        200
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "sheetId": "{{$env.GOOGLE_SHEET_ID}}",
        "range": "ASIN!A:E",
        "data": [
          [
            "={{$json.ASIN}}",
            "si",
            "={{$json.video}}",
            "={{$now.toISOString()}}",
            "2.50"
          ]
        ]
      },
      "id": "upd_sheet",
      "name": "Mark ASIN Done",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 2,
      "position": [
        1700,
        200
      ],
      "credentials": {
        "googleSheetsOAuth2Api": "Google-Diego"
      }
    }
  ],
  "connections": {
    "trigger": {
      "main": [
        [
          {
            "node": "get_asin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_asin": {
      "main": [
        [
          {
            "node": "gpt4o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gpt4o": {
      "main": [
        [
          {
            "node": "tts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tts": {
      "main": [
        [
          {
            "node": "sd35",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sd35": {
      "main": [
        [
          {
            "node": "fal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fal": {
      "main": [
        [
          {
            "node": "amzUp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "amzUp": {
      "main": [
        [
          {
            "node": "dashboardWebhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dashboardWebhook": {
      "main": [
        [
          {
            "node": "upd_sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "meta": {
    "version": "2025.11.13",
    "description": "Amazon Influencer Shorts - Crea videos verticales 9:16 para Amazon Influencer con monetización",
    "credentials": [
      "Google-Diego",
      "OpenAI-Diego",
      "ElevenLabs-Diego",
      "Stability-Diego",
      "Fal-Diego",
      "Amazon-Diego"
    ],
    "environment_variables": [
      "GOOGLE_SHEET_ID",
      "WEBHOOK_DASHBOARD_URL",
      "WEBHOOK_SECRET"
    ],
    "earnings_per_execution": "$0.80 - $4.50",
    "execution_frequency": "Every 4 hours"
  }
}
