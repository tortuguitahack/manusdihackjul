{
  "name": "04_Redbubble_Bulk_v2025",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "hours": 8
            }
          ]
        },
        "options": {
          "timezone": "America/La_Paz"
        }
      },
      "id": "trigger",
      "name": "Cada 8h",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        100,
        200
      ]
    },
    {
      "parameters": {
        "jsCode": "// Generar diseños para diferentes productos\nconst designs = [\n  { text: 'Code is Poetry', style: 'minimalist', products: ['tshirt', 'hoodie', 'mug'] },\n  { text: 'Digital Nomad Life', style: 'retro', products: ['tshirt', 'sticker', 'poster'] },\n  { text: 'Crypto Vibes', style: 'neon', products: ['hoodie', 'tshirt', 'hat'] }\n];\n\nconst design = designs[Math.floor(Math.random() * designs.length)];\nreturn [design];"
      },
      "id": "design_gen",
      "name": "Generate Design",
      "type": "n8n-nodes-base.code",
      "position": [
        300,
        200
      ]
    },
    {
      "parameters": {
        "operation": "generateImage",
        "model": "stable-diffusion-3-5-large",
        "prompt": "{{$json.style}} design with text '{{$json.text}}', transparent background, 2000x2000px, modern, trendy",
        "aspect_ratio": "1:1",
        "output_format": "png",
        "size": "2048x2048"
      },
      "id": "sd35",
      "name": "Generate Design Image",
      "type": "n8n-nodes-base.stabilityAi",
      "position": [
        500,
        200
      ],
      "credentials": {
        "stabilityAiApi": "Stability-Diego"
      }
    },
    {
      "parameters": {
        "batchSize": 3,
        "waitTime": 2
      },
      "id": "batch_products",
      "name": "Batch Products",
      "type": "n8n-nodes-base.splitInBatches",
      "position": [
        700,
        200
      ]
    },
    {
      "parameters": {
        "operation": "uploadDesign",
        "design": "={{$json.data[0].url}}",
        "title": "={{$json.text}} - {{$json.products[0]}}",
        "description": "{{$json.style}} design on {{$json.products[0]}}",
        "tags": "={{$json.text}}, {{$json.style}}, design, trending"
      },
      "id": "redbubble",
      "name": "Redbubble Upload",
      "type": "n8n-nodes-base.redbubble",
      "position": [
        900,
        200
      ],
      "credentials": {
        "redbubbleApi": "Redbubble-Diego"
      }
    },
    {
      "parameters": {
        "operation": "append",
        "sheetId": "{{$env.GOOGLE_SHEET_ID}}",
        "range": "Redbubble!A:E",
        "data": [
          [
            "={{$json.text}}",
            "={{$json.products[0]}}",
            "={{$json.design_id}}",
            "={{$now.toISOString()}}",
            "0"
          ]
        ]
      },
      "id": "log_rb",
      "name": "Log to Sheet",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        1100,
        200
      ],
      "credentials": {
        "googleSheetsOAuth2Api": "Google-Diego"
      }
    },
    {
      "parameters": {
        "url": "{{$env.WEBHOOK_DASHBOARD_URL}}/api/webhooks/n8n",
        "httpMethod": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer {{$env.WEBHOOK_SECRET}}"
        },
        "body": {
          "workflowId": "04_Redbubble_Bulk",
          "status": "completed",
          "earnings": 0,
          "timestamp": "={{$now.toISOString()}}",
          "metadata": {
            "designText": "={{$json.text}}",
            "products": "={{$json.products}}",
            "designUrl": "={{$json.data[0].url}}",
            "designId": "={{$json.design_id}}"
          }
        }
      },
      "id": "dashboardWebhook",
      "name": "Send to Dashboard",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1300,
        200
      ]
    }
  ],
  "connections": {
    "trigger": {
      "main": [
        [
          {
            "node": "design_gen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "design_gen": {
      "main": [
        [
          {
            "node": "sd35",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sd35": {
      "main": [
        [
          {
            "node": "batch_products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "batch_products": {
      "main": [
        [
          {
            "node": "redbubble",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "redbubble": {
      "main": [
        [
          {
            "node": "log_rb",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "log_rb": {
      "main": [
        [
          {
            "node": "dashboardWebhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "meta": {
    "version": "2025.11.13",
    "description": "Redbubble Bulk - Genera diseños y los sube masivamente a Redbubble (Print-on-Demand)",
    "credentials": [
      "Stability-Diego",
      "Redbubble-Diego",
      "Google-Diego"
    ],
    "environment_variables": [
      "GOOGLE_SHEET_ID",
      "WEBHOOK_DASHBOARD_URL",
      "WEBHOOK_SECRET"
    ],
    "earnings_per_execution": "$0.50 - $2.00 (per sale)",
    "execution_frequency": "Every 8 hours"
  }
}
